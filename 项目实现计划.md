# å³æ—¶é€šè®¯é¡¹ç›®åˆ†é˜¶æ®µå®ç°è®¡åˆ’

æœ¬è®¡åˆ’å°†é¡¹ç›®æ‹†åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µåŒæ­¥å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Œå¾ªåºæ¸è¿›åœ°å®Œæˆæ•´ä¸ªé¡¹ç›®ã€‚

## ğŸ“‹ æ€»ä½“ç­–ç•¥

- **åŒæ­¥å¼€å‘**ï¼šæ¯ä¸ªé˜¶æ®µå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¸€èµ·å®ç°
- **é€æ­¥æµ‹è¯•**ï¼šæ¯å®Œæˆä¸€ä¸ªé˜¶æ®µå°±è¿›è¡Œæµ‹è¯•éªŒè¯
- **åŠŸèƒ½å®Œæ•´**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½æ˜¯å¯è¿è¡Œçš„å®Œæ•´åŠŸèƒ½
- **ä»£ç è§„èŒƒ**ï¼šä»ä¸€å¼€å§‹å°±æ³¨æ„ä»£ç è´¨é‡å’Œæ¶æ„

---

## ğŸ¯ é˜¶æ®µä¸€ï¼šé¡¹ç›®åŸºç¡€æ­å»ºï¼ˆ1-2å¤©ï¼‰

### ç›®æ ‡
æ­å»ºé¡¹ç›®æ¡†æ¶ï¼Œåˆ›å»ºåŸºç¡€ç±»ï¼Œå®ç°æœ€ç®€å•çš„é€šä¿¡æµ‹è¯•ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 1.1 åˆ›å»ºé¡¹ç›®ç»“æ„
```
ChatClient/
â”œâ”€â”€ main.cpp
â”œâ”€â”€ ChatClient.pro
â”œâ”€â”€ comapi/
â”‚   â”œâ”€â”€ myapp.h
â”‚   â”œâ”€â”€ myapp.cpp
â”‚   â”œâ”€â”€ global.h
â”‚   â””â”€â”€ unit.h
â”œâ”€â”€ basewidget/
â”‚   â”œâ”€â”€ customwidget.h
â”‚   â””â”€â”€ customwidget.cpp
â””â”€â”€ resource/
    â””â”€â”€ qss/
        â””â”€â”€ default.css
```

#### 1.2 å®ç°åŸºç¡€ç±»

**myapp.h/cpp** - é…ç½®ç®¡ç†
```cpp
class MyApp {
public:
    static QString m_strAppPath;
    static QString m_strDatabasePath;
    static QString m_strHostAddr;
    static int m_nMsgPort;
    
    static void InitApp(const QString &appPath);
    static void CheckDirs();
};
```

**unit.h** - å®šä¹‰å¸¸é‡
```cpp
#define MSG_PORT_MESSAGE 5363
#define TCP_FILE_PORT 7777

typedef enum {
    Login = 0x11,
    Register = 0x10,
    SendMsg = 0x40,
} E_MSG_TYPE;

typedef enum {
    LoginSuccess = 0x03,
    LoginPasswdError = 0x04,
} E_STATUS;
```

**customwidget.h/cpp** - è‡ªå®šä¹‰çª—å£åŸºç±»
```cpp
class CustomMoveWidget : public QWidget {
    // å®ç°æ— è¾¹æ¡†çª—å£æ‹–åŠ¨
};
```

#### 1.3 åˆ›å»ºä¸»çª—å£æ¡†æ¶
```cpp
// mainwindow.h
class MainWindow : public CustomMoveWidget {
    Q_OBJECT
public:
    explicit MainWindow(QWidget *parent = 0);
};
```

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 1.1 åˆ›å»ºé¡¹ç›®ç»“æ„
```
ChatServer/
â”œâ”€â”€ main.cpp
â”œâ”€â”€ ChatServer.pro
â”œâ”€â”€ comapi/
â”‚   â”œâ”€â”€ myapp.h
â”‚   â”œâ”€â”€ myapp.cpp
â”‚   â””â”€â”€ unit.h
â””â”€â”€ resource/
    â””â”€â”€ qss/
        â””â”€â”€ default.css
```

#### 1.2 å®ç°åŸºç¡€ç±»
ï¼ˆåŒå®¢æˆ·ç«¯ï¼Œä½†é…ç½®ç•¥æœ‰ä¸åŒï¼‰

#### 1.3 åˆ›å»ºæœåŠ¡å™¨ä¸»çª—å£
```cpp
// mainwindow.h
class MainWindow : public CustomMoveWidget {
    Q_OBJECT
public:
    explicit MainWindow(QWidget *parent = 0);
    
private:
    void InitNetwork();
};
```

### æµ‹è¯•ç›®æ ‡
- âœ… ä¸¤ä¸ªç¨‹åºéƒ½èƒ½æ­£å¸¸å¯åŠ¨
- âœ… çª—å£å¯ä»¥æ­£å¸¸æ˜¾ç¤º
- âœ… é…ç½®å¯ä»¥æ­£å¸¸è¯»å–

### éªŒæ”¶æ ‡å‡†
- é¡¹ç›®ç»“æ„æ¸…æ™°
- åŸºç¡€ç±»å¯ä»¥æ­£å¸¸ä½¿ç”¨
- æ— ç¼–è¯‘é”™è¯¯

---

## ğŸ¯ é˜¶æ®µäºŒï¼šç½‘ç»œé€šä¿¡åŸºç¡€ï¼ˆ2-3å¤©ï¼‰

### ç›®æ ‡
å®ç° TCP è¿æ¥ï¼Œèƒ½å¤Ÿå‘é€å’Œæ¥æ”¶ç®€å•çš„æ¶ˆæ¯ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 2.1 å®ç° ClientSocket ç±»
```cpp
// clientsocket.h
class ClientSocket : public QObject {
    Q_OBJECT
public:
    explicit ClientSocket(QObject *parent = 0);
    void ConnectToHost(const QString &host, const int &port);
    
signals:
    void signalStatus(const quint8 &state);
    
private slots:
    void SltReadyRead();
    void SltConnected();
    void SltDisconnected();
    
private:
    QTcpSocket *m_tcpSocket;
    void SendMessage(const quint8 &type, const QJsonValue &dataVal);
};
```

#### 2.2 å®ç°æ¶ˆæ¯å‘é€
```cpp
void ClientSocket::SendMessage(const quint8 &type, const QJsonValue &dataVal)
{
    QJsonObject json;
    json.insert("type", type);
    json.insert("data", dataVal);
    
    QJsonDocument document;
    document.setObject(json);
    QByteArray byteArray = document.toJson(QJsonDocument::Compact);
    
    m_tcpSocket->write(byteArray);
}
```

#### 2.3 å®ç°æ¶ˆæ¯æ¥æ”¶
```cpp
void ClientSocket::SltReadyRead()
{
    QByteArray reply = m_tcpSocket->readAll();
    QJsonParseError jsonError;
    QJsonDocument document = QJsonDocument::fromJson(reply, &jsonError);
    
    if (!document.isNull() && (jsonError.error == QJsonParseError::NoError)) {
        QJsonObject jsonObj = document.object();
        int nType = jsonObj.value("type").toInt();
        QJsonValue dataVal = jsonObj.value("data");
        
        // å¤„ç†æ¶ˆæ¯
        qDebug() << "æ”¶åˆ°æ¶ˆæ¯ç±»å‹ï¼š" << nType;
    }
}
```

#### 2.4 åˆ›å»ºæµ‹è¯•ç•Œé¢
åœ¨ MainWindow ä¸­æ·»åŠ ï¼š
- æœåŠ¡å™¨åœ°å€è¾“å…¥æ¡†
- è¿æ¥æŒ‰é’®
- æ¶ˆæ¯è¾“å…¥æ¡†
- å‘é€æŒ‰é’®
- æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 2.1 å®ç° TcpServer åŸºç±»
```cpp
// tcpserver.h
class TcpServer : public QObject {
    Q_OBJECT
public:
    bool StartListen(int port = 5363);
    void CloseListen();
    
protected slots:
    virtual void SltNewConnection() = 0;
    
protected:
    QTcpServer *m_tcpServer;
};
```

#### 2.2 å®ç° TcpMsgServer
```cpp
// tcpserver.h
class TcpMsgServer : public TcpServer {
    Q_OBJECT
public:
    explicit TcpMsgServer(QObject *parent = 0);
    
private slots:
    void SltNewConnection() override;
    
private:
    QVector<QTcpSocket *> m_clients;
};
```

#### 2.3 å®ç°æ¶ˆæ¯æ¥æ”¶å’Œè½¬å‘
```cpp
void TcpMsgServer::SltNewConnection()
{
    QTcpSocket *socket = m_tcpServer->nextPendingConnection();
    m_clients.push_back(socket);
    
    connect(socket, SIGNAL(readyRead()), this, SLOT(SltReadyRead()));
    connect(socket, SIGNAL(disconnected()), this, SLOT(SltDisconnected()));
}

void TcpMsgServer::SltReadyRead()
{
    QTcpSocket *socket = qobject_cast<QTcpSocket *>(sender());
    QByteArray data = socket->readAll();
    
    // è§£ææ¶ˆæ¯
    QJsonDocument doc = QJsonDocument::fromJson(data);
    QJsonObject json = doc.object();
    
    // ç®€å•å›æ˜¾ï¼ˆæµ‹è¯•ç”¨ï¼‰
    socket->write(data);
}
```

#### 2.4 åˆ›å»ºæœåŠ¡å™¨ç®¡ç†ç•Œé¢
åœ¨ MainWindow ä¸­æ·»åŠ ï¼š
- å¯åŠ¨/åœæ­¢æœåŠ¡å™¨æŒ‰é’®
- è¿æ¥çŠ¶æ€æ˜¾ç¤º
- æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ

### æµ‹è¯•ç›®æ ‡
- âœ… å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°æœåŠ¡å™¨
- âœ… å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨å¯ä»¥æ¥æ”¶
- âœ… æœåŠ¡å™¨å¯ä»¥å›æ˜¾æ¶ˆæ¯ç»™å®¢æˆ·ç«¯
- âœ… å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶è¿æ¥

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨æœåŠ¡å™¨ï¼Œç‚¹å‡»"å¯åŠ¨ç›‘å¬"
2. å¯åŠ¨å®¢æˆ·ç«¯ï¼Œè¾“å…¥æœåŠ¡å™¨åœ°å€ï¼Œç‚¹å‡»"è¿æ¥"
3. å®¢æˆ·ç«¯å‘é€æµ‹è¯•æ¶ˆæ¯
4. æœåŠ¡å™¨æ¥æ”¶å¹¶å›æ˜¾
5. å®¢æˆ·ç«¯æ¥æ”¶å›æ˜¾æ¶ˆæ¯

### éªŒæ”¶æ ‡å‡†
- ç½‘ç»œè¿æ¥ç¨³å®š
- æ¶ˆæ¯å¯ä»¥æ­£å¸¸æ”¶å‘
- æ”¯æŒå¤šå®¢æˆ·ç«¯è¿æ¥

---

## ğŸ¯ é˜¶æ®µä¸‰ï¼šç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆ2-3å¤©ï¼‰

### ç›®æ ‡
å®ç°ç”¨æˆ·æ³¨å†Œå’Œç™»å½•åŠŸèƒ½ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 3.1 åˆ›å»ºç™»å½•ç•Œé¢
```cpp
// loginwidget.h
class LoginWidget : public CustomMoveWidget {
    Q_OBJECT
public:
    explicit LoginWidget(QWidget *parent = 0);
    
private slots:
    void on_btnLogin_clicked();
    void on_btnRegister_clicked();
    void SltTcpStatus(const quint8 &state);
    
private:
    Ui::LoginWidget *ui;
    ClientSocket *m_tcpSocket;
};
```

#### 3.2 å®ç°ç™»å½•åŠŸèƒ½
```cpp
void LoginWidget::on_btnLogin_clicked()
{
    QString name = ui->lineEditUser->text();
    QString passwd = ui->lineEditPasswd->text();
    
    QJsonObject json;
    json.insert("name", name);
    json.insert("passwd", passwd);
    
    m_tcpSocket->SltSendMessage(Login, json);
}
```

#### 3.3 å¤„ç†ç™»å½•å“åº”
```cpp
// clientsocket.cpp
void ClientSocket::SltReadyRead()
{
    // ... è§£ææ¶ˆæ¯
    
    switch (nType) {
    case Login:
        ParseLogin(dataVal);
        break;
    }
}

void ClientSocket::ParseLogin(const QJsonValue &dataVal)
{
    QJsonObject jsonObj = dataVal.toObject();
    int status = jsonObj.value("status").toInt();
    
    if (status == LoginSuccess) {
        int userId = jsonObj.value("id").toInt();
        m_nId = userId;
        Q_EMIT signalStatus(LoginSuccess);
    } else {
        Q_EMIT signalStatus(LoginPasswdError);
    }
}
```

#### 3.4 ç™»å½•æˆåŠŸåæ‰“å¼€ä¸»çª—å£
```cpp
// loginwidget.cpp
void LoginWidget::SltTcpStatus(const quint8 &state)
{
    if (state == LoginSuccess) {
        MainWindow *w = new MainWindow();
        w->SetSocket(m_tcpSocket, ui->lineEditUser->text());
        w->show();
        this->close();
    } else if (state == LoginPasswdError) {
        QMessageBox::warning(this, "é”™è¯¯", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }
}
```

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 3.1 åˆ›å»ºæ•°æ®åº“ç®¡ç†ç±»
```cpp
// databasemagr.h
class DataBaseMagr : public QObject {
    Q_OBJECT
public:
    static DataBaseMagr *Instance();
    bool OpenDb(const QString &dataName);
    QJsonObject CheckUserLogin(const QString &name, const QString &passwd);
    int RegisterUser(const QString &name, const QString &passwd);
    
private:
    static DataBaseMagr *self;
    QSqlDatabase userdb;
};
```

#### 3.2 åˆ›å»ºæ•°æ®åº“è¡¨
```cpp
bool DataBaseMagr::OpenDb(const QString &dataName)
{
    userdb = QSqlDatabase::addDatabase("QSQLITE");
    userdb.setDatabaseName(dataName);
    if (!userdb.open()) {
        return false;
    }
    
    QSqlQuery query;
    query.exec("CREATE TABLE USERINFO ("
               "id INTEGER PRIMARY KEY AUTOINCREMENT, "
               "name varchar(20) UNIQUE, "
               "passwd varchar(20), "
               "status INTEGER DEFAULT 0, "
               "lasttime DATETIME)");
    
    return true;
}
```

#### 3.3 å®ç°ç™»å½•éªŒè¯
```cpp
QJsonObject DataBaseMagr::CheckUserLogin(const QString &name, const QString &passwd)
{
    QJsonObject json;
    
    QSqlQuery query;
    query.prepare("SELECT id, passwd, status FROM USERINFO WHERE name = ?");
    query.addBindValue(name);
    
    if (query.exec() && query.next()) {
        int id = query.value(0).toInt();
        QString dbPasswd = query.value(1).toString();
        
        if (dbPasswd == passwd) {
            // æ›´æ–°çŠ¶æ€
            query.prepare("UPDATE USERINFO SET status = 1, lasttime = ? WHERE id = ?");
            query.addBindValue(QDateTime::currentDateTime().toString());
            query.addBindValue(id);
            query.exec();
            
            json.insert("status", LoginSuccess);
            json.insert("id", id);
        } else {
            json.insert("status", LoginPasswdError);
        }
    } else {
        json.insert("status", LoginPasswdError);
    }
    
    return json;
}
```

#### 3.4 å®ç°ç”¨æˆ·æ³¨å†Œ
```cpp
int DataBaseMagr::RegisterUser(const QString &name, const QString &passwd)
{
    QSqlQuery query;
    query.prepare("SELECT id FROM USERINFO WHERE name = ?");
    query.addBindValue(name);
    
    if (query.exec() && query.next()) {
        return -1;  // ç”¨æˆ·åå·²å­˜åœ¨
    }
    
    query.prepare("INSERT INTO USERINFO (name, passwd, status, lasttime) "
                  "VALUES (?, ?, 0, ?)");
    query.addBindValue(name);
    query.addBindValue(passwd);
    query.addBindValue(QDateTime::currentDateTime().toString());
    
    if (query.exec()) {
        return query.lastInsertId().toInt();
    }
    
    return -1;
}
```

#### 3.5 åœ¨ ClientSocket ä¸­å¤„ç†ç™»å½•è¯·æ±‚
```cpp
// clientsocket.cpp (æœåŠ¡å™¨ç«¯)
void ClientSocket::SltReadyRead()
{
    // ... è§£ææ¶ˆæ¯
    
    switch (nType) {
    case Login: {
        QJsonObject jsonObj = dataVal.toObject();
        QString name = jsonObj.value("name").toString();
        QString passwd = jsonObj.value("passwd").toString();
        
        QJsonObject result = DataBaseMagr::Instance()->CheckUserLogin(name, passwd);
        
        if (result.value("status").toInt() == LoginSuccess) {
            m_nId = result.value("id").toInt();
        }
        
        SendMessage(Login, result);
        break;
    }
    case Register: {
        QJsonObject jsonObj = dataVal.toObject();
        QString name = jsonObj.value("name").toString();
        QString passwd = jsonObj.value("passwd").toString();
        
        int userId = DataBaseMagr::Instance()->RegisterUser(name, passwd);
        
        QJsonObject result;
        if (userId > 0) {
            result.insert("status", RegisterOk);
            result.insert("id", userId);
        } else {
            result.insert("status", RegisterFailed);
        }
        
        SendMessage(Register, result);
        break;
    }
    }
}
```

### æµ‹è¯•ç›®æ ‡
- âœ… å¯ä»¥æ³¨å†Œæ–°ç”¨æˆ·
- âœ… å¯ä»¥ç™»å½•å·²æ³¨å†Œç”¨æˆ·
- âœ… å¯†ç é”™è¯¯æ—¶æç¤ºé”™è¯¯
- âœ… ç™»å½•åæ‰“å¼€ä¸»çª—å£
- âœ… ç”¨æˆ·çŠ¶æ€åœ¨æ•°æ®åº“ä¸­æ­£ç¡®æ›´æ–°

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨æœåŠ¡å™¨
2. å®¢æˆ·ç«¯æ³¨å†Œæ–°ç”¨æˆ·ï¼ˆç”¨æˆ·åï¼štestï¼Œå¯†ç ï¼š123456ï¼‰
3. å®¢æˆ·ç«¯ä½¿ç”¨æ­£ç¡®å¯†ç ç™»å½•ï¼Œåº”è¯¥æˆåŠŸ
4. å®¢æˆ·ç«¯ä½¿ç”¨é”™è¯¯å¯†ç ç™»å½•ï¼Œåº”è¯¥å¤±è´¥
5. æ£€æŸ¥æ•°æ®åº“ï¼Œç¡®è®¤ç”¨æˆ·ä¿¡æ¯æ­£ç¡®

### éªŒæ”¶æ ‡å‡†
- æ³¨å†Œå’Œç™»å½•åŠŸèƒ½æ­£å¸¸
- æ•°æ®åº“æ“ä½œæ­£ç¡®
- é”™è¯¯å¤„ç†å®Œå–„

---

## ğŸ¯ é˜¶æ®µå››ï¼šæ•°æ®åº“è®¾è®¡ï¼ˆ1-2å¤©ï¼‰

### ç›®æ ‡
å®Œå–„æ•°æ®åº“è®¾è®¡ï¼Œå®ç°å®¢æˆ·ç«¯æœ¬åœ°æ•°æ®åº“ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 4.1 åˆ›å»ºå®¢æˆ·ç«¯æ•°æ®åº“ç®¡ç†ç±»
```cpp
// databasemagr.h
class DataBaseMagr : public QObject {
    Q_OBJECT
public:
    static DataBaseMagr *Instance();
    bool OpenUserDb(const QString &dataName);
    bool OpenMessageDb(const QString &dataName);
    
    // å¥½å‹æ“ä½œ
    void AddFriend(const int &id, const int &userId, const QString &name);
    QJsonArray GetMyFriend(const int &userId) const;
    
    // æ¶ˆæ¯æ“ä½œ
    void AddHistoryMsg(const int &userId, const QString &name, 
                       const QString &text, const QString &time);
    QVector<QJsonObject> QueryHistory(const int &id, const int &count = 0);
    
private:
    static DataBaseMagr *self;
    QSqlDatabase userdb;
    QSqlDatabase msgdb;
};
```

#### 4.2 åˆ›å»ºå®¢æˆ·ç«¯æ•°æ®åº“è¡¨
```cpp
bool DataBaseMagr::OpenUserDb(const QString &dataName)
{
    userdb = QSqlDatabase::addDatabase("QSQLITE", "connectionUser");
    userdb.setDatabaseName(dataName);
    if (!userdb.open()) {
        return false;
    }
    
    QSqlQuery query(userdb);
    query.exec("CREATE TABLE IF NOT EXISTS FRIEND ("
               "id INT, userId INT, name varchar(50))");
    
    query.exec("CREATE TABLE IF NOT EXISTS USERINFO ("
               "id INT, name varchar(50), passwd varchar(50))");
    
    return true;
}

bool DataBaseMagr::OpenMessageDb(const QString &dataName)
{
    msgdb = QSqlDatabase::addDatabase("QSQLITE", "connectionMsg");
    msgdb.setDatabaseName(dataName);
    if (!msgdb.open()) {
        return false;
    }
    
    QSqlQuery query(msgdb);
    query.exec("CREATE TABLE IF NOT EXISTS MSGINFO ("
               "id INTEGER PRIMARY KEY AUTOINCREMENT, "
               "userId INT, name varchar(20), "
               "head varchar(50), datetime varchar(20), "
               "content varchar(500), type INT, direction INT)");
    
    return true;
}
```

#### 4.3 åœ¨ main.cpp ä¸­åˆå§‹åŒ–æ•°æ®åº“
```cpp
int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    MyApp::InitApp(a.applicationDirPath());
    
    // æ‰“å¼€æ•°æ®åº“
    DataBaseMagr::Instance()->OpenUserDb(
        MyApp::m_strDatabasePath + "user.db");
    DataBaseMagr::Instance()->OpenMessageDb(
        MyApp::m_strDatabasePath + "msg.db");
    
    LoginWidget w;
    w.show();
    
    return a.exec();
}
```

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 4.1 å®Œå–„æœåŠ¡å™¨æ•°æ®åº“
æ·»åŠ å¥½å‹å…³ç³»è¡¨ï¼ˆå¯é€‰ï¼Œå½“å‰é¡¹ç›®æœªä½¿ç”¨ï¼‰ï¼š
```cpp
// å¦‚æœéœ€è¦å­˜å‚¨å¥½å‹å…³ç³»
query.exec("CREATE TABLE IF NOT EXISTS FRIENDS ("
           "id INTEGER PRIMARY KEY AUTOINCREMENT, "
           "userId INT, friendId INT, "
           "UNIQUE(userId, friendId))");
```

### æµ‹è¯•ç›®æ ‡
- âœ… å®¢æˆ·ç«¯æ•°æ®åº“å¯ä»¥æ­£å¸¸åˆ›å»º
- âœ… è¡¨ç»“æ„æ­£ç¡®
- âœ… å¯ä»¥æ‰§è¡ŒåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ“ä½œ

### éªŒæ”¶æ ‡å‡†
- æ•°æ®åº“æ–‡ä»¶æ­£ç¡®åˆ›å»º
- è¡¨ç»“æ„ç¬¦åˆè®¾è®¡
- åŸºæœ¬æ“ä½œæ­£å¸¸

---

## ğŸ¯ é˜¶æ®µäº”ï¼šå¥½å‹ç®¡ç†ï¼ˆ3-4å¤©ï¼‰

### ç›®æ ‡
å®ç°æ·»åŠ å¥½å‹ã€æ˜¾ç¤ºå¥½å‹åˆ—è¡¨ã€å¥½å‹çŠ¶æ€ç®¡ç†ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 5.1 åˆ›å»ºå¥½å‹åˆ—è¡¨ç»„ä»¶
```cpp
// basewidget/qqlist/qqlistview.h
class QQListView : public QWidget {
    Q_OBJECT
signals:
    void signalFriendsClicked(QQCell *cell);
    
public:
    void AddFriend(QQCell *cell);
    void UpdateFriendStatus(int id, int status);
};
```

#### 5.2 åœ¨ä¸»çª—å£æ˜¾ç¤ºå¥½å‹åˆ—è¡¨
```cpp
// mainwindow.h
class MainWindow : public CustomMoveWidget {
    Q_OBJECT
private:
    QQListView *m_friendListView;
    
private slots:
    void SltFriendsClicked(QQCell *cell);
    void onAddFriendMenuDidSelected(QAction *action);
};
```

#### 5.3 å®ç°æ·»åŠ å¥½å‹åŠŸèƒ½
```cpp
void MainWindow::onAddFriendMenuDidSelected(QAction *action)
{
    if (action->text() == "æ·»åŠ å¥½å‹") {
        bool ok;
        QString name = QInputDialog::getText(this, "æ·»åŠ å¥½å‹", 
                                            "è¯·è¾“å…¥å¥½å‹ç”¨æˆ·åï¼š",
                                            QLineEdit::Normal, "", &ok);
        if (ok && !name.isEmpty()) {
            QJsonObject json;
            json.insert("name", name);
            m_tcpSocket->SltSendMessage(AddFriend, json);
        }
    }
}
```

#### 5.4 å¤„ç†æ·»åŠ å¥½å‹å“åº”
```cpp
void MainWindow::ParseAddFriendReply(const QJsonValue &dataVal)
{
    QJsonObject jsonObj = dataVal.toObject();
    int id = jsonObj.value("id").toInt();
    QString name = jsonObj.value("name").toString();
    
    if (id > 0) {
        // ä¿å­˜åˆ°æ•°æ®åº“
        DataBaseMagr::Instance()->AddFriend(id, MyApp::m_nId, name);
        
        // æ·»åŠ åˆ°åˆ—è¡¨
        QQCell *cell = new QQCell();
        cell->id = id;
        cell->name = name;
        m_friendListView->AddFriend(cell);
    }
}
```

#### 5.5 å®ç°è·å–å¥½å‹åˆ—è¡¨
```cpp
void MainWindow::SetSocket(ClientSocket *tcpSocket, const QString &name)
{
    m_tcpSocket = tcpSocket;
    
    // ä»æœ¬åœ°æ•°æ®åº“åŠ è½½å¥½å‹åˆ—è¡¨
    QJsonArray friendArr = DataBaseMagr::Instance()->GetMyFriend(MyApp::m_nId);
    
    // è¯·æ±‚æœåŠ¡å™¨æ›´æ–°å¥½å‹çŠ¶æ€
    m_tcpSocket->SltSendMessage(GetMyFriends, friendArr);
}
```

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 5.1 å®ç°æ·»åŠ å¥½å‹æŸ¥è¯¢
```cpp
// databasemagr.cpp
QJsonObject DataBaseMagr::AddFriend(const QString &name)
{
    QJsonObject json;
    
    QSqlQuery query;
    query.prepare("SELECT id, status, head FROM USERINFO WHERE name = ?");
    query.addBindValue(name);
    
    if (query.exec() && query.next()) {
        json.insert("id", query.value(0).toInt());
        json.insert("name", name);
        json.insert("status", query.value(1).toInt());
        json.insert("head", query.value(2).toString());
    } else {
        json.insert("id", -1);
    }
    
    return json;
}
```

#### 5.2 å®ç°è·å–å¥½å‹çŠ¶æ€
```cpp
// clientsocket.cpp (æœåŠ¡å™¨ç«¯)
void ClientSocket::ParseGetMyFriends(const QJsonValue &dataVal)
{
    QJsonArray friendArr = dataVal.toArray();
    QJsonArray resultArr;
    
    foreach (QJsonValue val, friendArr) {
        int friendId = val.toInt();
        QJsonObject userInfo = DataBaseMagr::Instance()->GetUserStatus(friendId);
        resultArr.append(userInfo);
    }
    
    SendMessage(GetMyFriends, resultArr);
}
```

#### 5.3 å®ç°ç”¨æˆ·çŠ¶æ€æ›´æ–°é€šçŸ¥
```cpp
// tcpserver.cpp
void TcpMsgServer::SltConnected()
{
    ClientSocket *client = (ClientSocket *)sender();
    m_clients.push_back(client);
    
    // é€šçŸ¥å…¶ä»–ç”¨æˆ·è¯¥ç”¨æˆ·ä¸Šçº¿
    QJsonObject json;
    json.insert("id", client->GetUserId());
    json.insert("status", OnLine);
    
    foreach (ClientSocket *c, m_clients) {
        if (c != client) {
            c->SendMessage(UserOnLine, json);
        }
    }
}
```

### æµ‹è¯•ç›®æ ‡
- âœ… å¯ä»¥æ·»åŠ å¥½å‹
- âœ… å¥½å‹åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- âœ… å¥½å‹åœ¨çº¿çŠ¶æ€æ­£ç¡®æ˜¾ç¤º
- âœ… å¥½å‹ä¸Šçº¿/ä¸‹çº¿æœ‰é€šçŸ¥

### éªŒæ”¶æ ‡å‡†
- å¥½å‹ç®¡ç†åŠŸèƒ½å®Œæ•´
- çŠ¶æ€åŒæ­¥æ­£ç¡®
- ç•Œé¢æ˜¾ç¤ºæ­£å¸¸

---

## ğŸ¯ é˜¶æ®µå…­ï¼šåŸºç¡€èŠå¤©åŠŸèƒ½ï¼ˆ3-4å¤©ï¼‰

### ç›®æ ‡
å®ç°ä¸€å¯¹ä¸€æ–‡å­—èŠå¤©ï¼ŒåŒ…æ‹¬æ¶ˆæ¯å‘é€ã€æ¥æ”¶ã€æ˜¾ç¤ºã€å†å²è®°å½•ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 6.1 åˆ›å»ºèŠå¤©çª—å£
```cpp
// uipage/chatwindow.h
class ChatWindow : public CustomMoveWidget {
    Q_OBJECT
public:
    void SetCell(QQCell *cell);
    void AddMessage(const QJsonValue &json);
    
signals:
    void signalClose();
    void signalSendMessage(const quint8 &type, const QJsonValue &json);
    
private slots:
    void on_btnSendMsg_clicked();
    
private:
    QQCell *m_cell;
    void LoadHistory();
};
```

#### 6.2 å®ç°æ¶ˆæ¯å‘é€
```cpp
void ChatWindow::on_btnSendMsg_clicked()
{
    QString text = ui->textEditMsg->toPlainText();
    if (text.isEmpty()) return;
    
    QJsonObject json;
    json.insert("id", m_cell->id);
    json.insert("text", text);
    json.insert("time", QDateTime::currentDateTime().toString("yyyy/MM/dd hh:mm:ss"));
    
    // å‘é€æ¶ˆæ¯
    Q_EMIT signalSendMessage(SendMsg, json);
    
    // æ·»åŠ åˆ°ç•Œé¢ï¼ˆå‘é€çš„æ¶ˆæ¯ï¼‰
    AddMessageToUI(json, true);
    
    // ä¿å­˜åˆ°æ•°æ®åº“
    DataBaseMagr::Instance()->AddHistoryMsg(
        m_cell->id, m_cell->name, text, 
        QDateTime::currentDateTime().toString("yyyy/MM/dd hh:mm:ss"));
    
    ui->textEditMsg->clear();
}
```

#### 6.3 å®ç°æ¶ˆæ¯æ˜¾ç¤º
```cpp
void ChatWindow::AddMessage(const QJsonValue &json)
{
    QJsonObject jsonObj = json.toObject();
    QString text = jsonObj.value("text").toString();
    QString time = jsonObj.value("time").toString();
    QString fromName = jsonObj.value("fromName").toString();
    
    // æ ¼å¼åŒ–ä¸º HTML
    QString html = QString("<div style='margin:5px;'>"
                           "<span style='color:gray;'>%1 %2</span><br>"
                           "<div style='background:#e0e0e0;padding:5px;border-radius:5px;'>"
                           "%3</div></div>")
                   .arg(fromName).arg(time).arg(text);
    
    ui->textBrowser->append(html);
    
    // ä¿å­˜åˆ°æ•°æ®åº“
    DataBaseMagr::Instance()->AddHistoryMsg(
        m_cell->id, fromName, text, time);
}
```

#### 6.4 å®ç°å†å²è®°å½•åŠ è½½
```cpp
void ChatWindow::LoadHistory()
{
    QVector<QJsonObject> history = 
        DataBaseMagr::Instance()->QueryHistory(m_cell->id, 20);
    
    foreach (QJsonObject msg, history) {
        QString html = QString("<div style='margin:5px;'>"
                               "<span style='color:gray;'>%1 %2</span><br>"
                               "<div style='background:#e0e0e0;padding:5px;border-radius:5px;'>"
                               "%3</div></div>")
                       .arg(msg.value("name").toString())
                       .arg(msg.value("datetime").toString())
                       .arg(msg.value("content").toString());
        
        ui->textBrowser->append(html);
    }
}
```

#### 6.5 åœ¨ä¸»çª—å£ç®¡ç†èŠå¤©çª—å£
```cpp
void MainWindow::SltFriendsClicked(QQCell *cell)
{
    // æŸ¥æ‰¾æ˜¯å¦å·²æ‰“å¼€
    foreach (ChatWindow *window, m_chatFriendWindows) {
        if (window->GetUserId() == cell->id) {
            window->raise();
            window->activateWindow();
            return;
        }
    }
    
    // åˆ›å»ºæ–°çª—å£
    ChatWindow *window = new ChatWindow();
    window->SetCell(cell);
    connect(window, SIGNAL(signalClose()), this, SLOT(SltFriendChatWindowClose()));
    connect(window, SIGNAL(signalSendMessage(quint8,QJsonValue)), 
            this, SLOT(SltSendMessage(quint8,QJsonValue)));
    
    m_chatFriendWindows.append(window);
    window->show();
}
```

#### 6.6 å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
```cpp
void MainWindow::ParseFriendMessageReply(const QJsonValue &dataVal)
{
    QJsonObject jsonObj = dataVal.toObject();
    int fromId = jsonObj.value("from").toInt();
    
    // æŸ¥æ‰¾æˆ–åˆ›å»ºèŠå¤©çª—å£
    ChatWindow *window = NULL;
    foreach (ChatWindow *w, m_chatFriendWindows) {
        if (w->GetUserId() == fromId) {
            window = w;
            break;
        }
    }
    
    if (!window) {
        // åˆ›å»ºæ–°çª—å£
        QQCell *cell = new QQCell();
        cell->id = fromId;
        cell->name = jsonObj.value("fromName").toString();
        SltFriendsClicked(cell);
        window = m_chatFriendWindows.last();
    }
    
    window->AddMessage(dataVal);
}
```

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 6.1 å®ç°æ¶ˆæ¯è½¬å‘
```cpp
// clientsocket.cpp (æœåŠ¡å™¨ç«¯)
void ClientSocket::ParseSendMessage(const int &fromId, const QJsonValue &dataVal)
{
    QJsonObject jsonObj = dataVal.toObject();
    int toId = jsonObj.value("id").toInt();
    
    // æ„é€ è½¬å‘æ¶ˆæ¯
    QJsonObject forwardMsg;
    forwardMsg.insert("from", fromId);
    forwardMsg.insert("fromName", DataBaseMagr::Instance()->GetUserName(fromId));
    forwardMsg.insert("text", jsonObj.value("text").toString());
    forwardMsg.insert("time", jsonObj.value("time").toString());
    
    // å‘é€ä¿¡å·ï¼Œè®© TcpMsgServer è½¬å‘
    Q_EMIT signalMsgToClient(SendMsg, toId, forwardMsg);
}
```

#### 6.2 åœ¨ TcpMsgServer ä¸­å®ç°è½¬å‘
```cpp
void TcpMsgServer::SltMsgToClient(const quint8 &type, 
                                   const int &id, 
                                   const QJsonValue &json)
{
    // æŸ¥æ‰¾ç›®æ ‡å®¢æˆ·ç«¯
    foreach (ClientSocket *client, m_clients) {
        if (client->GetUserId() == id) {
            client->SendMessage(type, json);
            break;
        }
    }
}
```

### æµ‹è¯•ç›®æ ‡
- âœ… å¯ä»¥å‘é€æ¶ˆæ¯
- âœ… å¯¹æ–¹å¯ä»¥æ¥æ”¶æ¶ˆæ¯
- âœ… æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º
- âœ… å†å²è®°å½•å¯ä»¥åŠ è½½
- âœ… å¤šä¸ªèŠå¤©çª—å£å¯ä»¥åŒæ—¶æ‰“å¼€

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨æœåŠ¡å™¨
2. å¯åŠ¨ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œåˆ†åˆ«ç™»å½•ä¸åŒç”¨æˆ·
3. å®¢æˆ·ç«¯Aæ·»åŠ å®¢æˆ·ç«¯Bä¸ºå¥½å‹
4. å®¢æˆ·ç«¯Aå‘å®¢æˆ·ç«¯Bå‘é€æ¶ˆæ¯
5. å®¢æˆ·ç«¯Bæ¥æ”¶å¹¶æ˜¾ç¤ºæ¶ˆæ¯
6. å…³é—­èŠå¤©çª—å£åé‡æ–°æ‰“å¼€ï¼ŒéªŒè¯å†å²è®°å½•

### éªŒæ”¶æ ‡å‡†
- èŠå¤©åŠŸèƒ½å®Œæ•´
- æ¶ˆæ¯æ”¶å‘æ­£å¸¸
- å†å²è®°å½•æ­£ç¡®

---

## ğŸ¯ é˜¶æ®µä¸ƒï¼šç¾¤ç»„åŠŸèƒ½ï¼ˆ3-4å¤©ï¼‰

### ç›®æ ‡
å®ç°ç¾¤ç»„åˆ›å»ºã€åŠ å…¥ã€ç¾¤ç»„èŠå¤©ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 7.1 å®ç°ç¾¤ç»„åˆ—è¡¨
ï¼ˆç±»ä¼¼å¥½å‹åˆ—è¡¨ï¼‰

#### 7.2 å®ç°åˆ›å»ºç¾¤ç»„
```cpp
void MainWindow::onCreateGroupMenuDidSelected(QAction *action)
{
    if (action->text() == "åˆ›å»ºç¾¤ç»„") {
        bool ok;
        QString name = QInputDialog::getText(this, "åˆ›å»ºç¾¤ç»„", 
                                            "è¯·è¾“å…¥ç¾¤ç»„åç§°ï¼š",
                                            QLineEdit::Normal, "", &ok);
        if (ok && !name.isEmpty()) {
            QJsonObject json;
            json.insert("name", name);
            m_tcpSocket->SltSendMessage(CreateGroup, json);
        }
    }
}
```

#### 7.3 å®ç°ç¾¤ç»„èŠå¤©
```cpp
void ChatWindow::on_btnSendMsg_clicked()
{
    // ... è·å–æ¶ˆæ¯å†…å®¹
    
    if (m_nChatType == 0) {  // ç§èŠ
        Q_EMIT signalSendMessage(SendMsg, json);
    } else {  // ç¾¤èŠ
        Q_EMIT signalSendMessage(SendGroupMsg, json);
    }
}
```

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 7.1 å®ç°ç¾¤ç»„æ•°æ®åº“è¡¨
```cpp
// databasemagr.cpp
query.exec("CREATE TABLE IF NOT EXISTS GROUPINFO ("
           "id INTEGER PRIMARY KEY AUTOINCREMENT, "
           "groupId INT, name varchar(20), "
           "head varchar(20), userId INT, identity INT)");
```

#### 7.2 å®ç°åˆ›å»ºç¾¤ç»„
```cpp
QJsonObject DataBaseMagr::CreateGroup(const int &userId, const QString &name)
{
    // æŸ¥è¯¢æœ€å¤§ groupId
    QSqlQuery query;
    query.exec("SELECT MAX(groupId) FROM GROUPINFO");
    int groupId = 1;
    if (query.next()) {
        groupId = query.value(0).toInt() + 1;
    }
    
    // æ’å…¥ç¾¤ç»„è®°å½•
    query.prepare("INSERT INTO GROUPINFO (groupId, name, userId, identity) "
                  "VALUES (?, ?, ?, 1)");
    query.addBindValue(groupId);
    query.addBindValue(name);
    query.addBindValue(userId);
    query.exec();
    
    QJsonObject json;
    json.insert("id", groupId);
    json.insert("name", name);
    return json;
}
```

#### 7.3 å®ç°ç¾¤ç»„æ¶ˆæ¯å¹¿æ’­
```cpp
void ClientSocket::ParseSendGroupMessage(const int &fromId, const QJsonValue &dataVal)
{
    QJsonObject jsonObj = dataVal.toObject();
    int groupId = jsonObj.value("id").toInt();
    
    // è·å–ç¾¤ç»„æˆå‘˜
    QJsonArray members = DataBaseMagr::Instance()->GetGroupUsers(groupId);
    
    // æ„é€ ç¾¤ç»„æ¶ˆæ¯
    QJsonObject groupMsg;
    groupMsg.insert("groupId", groupId);
    groupMsg.insert("from", fromId);
    groupMsg.insert("fromName", DataBaseMagr::Instance()->GetUserName(fromId));
    groupMsg.insert("text", jsonObj.value("text").toString());
    groupMsg.insert("time", jsonObj.value("time").toString());
    
    // å¹¿æ’­ç»™æ‰€æœ‰æˆå‘˜ï¼ˆé™¤äº†å‘é€è€…ï¼‰
    foreach (QJsonValue member, members) {
        int memberId = member.toObject().value("id").toInt();
        if (memberId != fromId) {
            Q_EMIT signalMsgToClient(SendGroupMsg, memberId, groupMsg);
        }
    }
}
```

### æµ‹è¯•ç›®æ ‡
- âœ… å¯ä»¥åˆ›å»ºç¾¤ç»„
- âœ… å¯ä»¥åŠ å…¥ç¾¤ç»„
- âœ… ç¾¤ç»„æ¶ˆæ¯å¯ä»¥å¹¿æ’­
- âœ… ç¾¤ç»„æˆå‘˜åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º

### éªŒæ”¶æ ‡å‡†
- ç¾¤ç»„åŠŸèƒ½å®Œæ•´
- æ¶ˆæ¯å¹¿æ’­æ­£ç¡®
- ç•Œé¢æ˜¾ç¤ºæ­£å¸¸

---

## ğŸ¯ é˜¶æ®µå…«ï¼šæ–‡ä»¶ä¼ è¾“ï¼ˆ3-4å¤©ï¼‰

### ç›®æ ‡
å®ç°æ–‡ä»¶å‘é€å’Œæ¥æ”¶åŠŸèƒ½ã€‚

### å®¢æˆ·ç«¯ä»»åŠ¡

#### 8.1 åˆ›å»ºæ–‡ä»¶ä¼ è¾“ Socket
```cpp
// clientsocket.h
class ClientFileSocket : public QObject {
    Q_OBJECT
public:
    void ConnectToServer(const QString &ip, const int &port, const int &usrId);
    void StartTransferFile(QString fileReadName);
    
signals:
    void signalUpdateProgress(quint64 currSize, quint64 total);
    void signamFileRecvOk(const quint8 &type, const QString &filePath);
    
private slots:
    void SltUpdateClientProgress(qint64);
    void SltReadyRead();
};
```

#### 8.2 å®ç°æ–‡ä»¶å‘é€
```cpp
void ClientFileSocket::StartTransferFile(QString fileReadName)
{
    QFileInfo fileInfo(fileReadName);
    m_fileToSend = new QFile(fileReadName);
    
    if (!m_fileToSend->open(QFile::ReadOnly)) {
        return;
    }
    
    m_ullSendTotalBytes = m_fileToSend->size();
    
    // å…ˆå‘é€æ–‡ä»¶ä¿¡æ¯
    QJsonObject json;
    json.insert("fileName", fileInfo.fileName());
    json.insert("fileSize", m_ullSendTotalBytes);
    
    QJsonDocument doc(json);
    m_tcpSocket->write(doc.toJson());
    
    // ç„¶åå‘é€æ–‡ä»¶æ•°æ®
    m_bytesToWrite = m_ullSendTotalBytes;
    m_outBlock = m_fileToSend->read(qMin(m_bytesToWrite, m_loadSize));
    m_tcpSocket->write(m_outBlock);
    m_bytesToWrite -= m_outBlock.size();
    m_outBlock.resize(0);
}
```

#### 8.3 åœ¨èŠå¤©çª—å£é›†æˆæ–‡ä»¶ä¼ è¾“
```cpp
void ChatWindow::on_btnSendFile_clicked()
{
    QString fileName = QFileDialog::getOpenFileName(this, "é€‰æ‹©æ–‡ä»¶");
    if (fileName.isEmpty()) return;
    
    // è¿æ¥æ–‡ä»¶æœåŠ¡å™¨
    m_tcpFileSocket->ConnectToServer(
        MyApp::m_strHostAddr, MyApp::m_nFilePort, MyApp::m_nId);
    
    // å‘é€æ–‡ä»¶
    m_tcpFileSocket->StartTransferFile(fileName);
}
```

### æœåŠ¡å™¨ç«¯ä»»åŠ¡

#### 8.1 åˆ›å»ºæ–‡ä»¶æœåŠ¡å™¨
```cpp
// tcpserver.h
class TcpFileServer : public TcpServer {
    Q_OBJECT
private slots:
    void SltNewConnection() override;
    void SltReadyRead();
    
private:
    QVector<QTcpSocket *> m_clients;
};
```

#### 8.2 å®ç°æ–‡ä»¶æ¥æ”¶
```cpp
void TcpFileServer::SltReadyRead()
{
    QTcpSocket *socket = qobject_cast<QTcpSocket *>(sender());
    QByteArray data = socket->readAll();
    
    // è§£ææ–‡ä»¶ä¿¡æ¯
    QJsonDocument doc = QJsonDocument::fromJson(data);
    if (doc.isObject()) {
        QJsonObject json = doc.object();
        QString fileName = json.value("fileName").toString();
        qint64 fileSize = json.value("fileSize").toInt();
        
        // åˆ›å»ºæ–‡ä»¶
        QFile *file = new QFile(MyApp::m_strRecvPath + fileName);
        file->open(QFile::WriteOnly);
        
        // å­˜å‚¨æ–‡ä»¶ä¿¡æ¯
        m_fileMap[socket] = file;
        m_fileSizeMap[socket] = fileSize;
    } else {
        // æ¥æ”¶æ–‡ä»¶æ•°æ®
        QFile *file = m_fileMap[socket];
        if (file) {
            file->write(data);
        }
    }
}
```

### æµ‹è¯•ç›®æ ‡
- âœ… å¯ä»¥å‘é€æ–‡ä»¶
- âœ… å¯ä»¥æ¥æ”¶æ–‡ä»¶
- âœ… ä¼ è¾“è¿›åº¦æ­£ç¡®æ˜¾ç¤º
- âœ… æ–‡ä»¶å®Œæ•´æ€§æ­£ç¡®

### éªŒæ”¶æ ‡å‡†
- æ–‡ä»¶ä¼ è¾“åŠŸèƒ½å®Œæ•´
- è¿›åº¦æ˜¾ç¤ºæ­£å¸¸
- æ–‡ä»¶å®Œæ•´æ€§ä¿è¯

---

## ğŸ¯ é˜¶æ®µä¹ï¼šå®Œå–„å’Œä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰

### ç›®æ ‡
å®Œå–„åŠŸèƒ½ï¼Œä¼˜åŒ–ä½“éªŒï¼Œä¿®å¤ bugã€‚

### ä»»åŠ¡æ¸…å•

#### 9.1 ç•Œé¢ä¼˜åŒ–
- [ ] ç¾åŒ–ç•Œé¢æ ·å¼
- [ ] æ·»åŠ åŠ¨ç”»æ•ˆæœ
- [ ] ä¼˜åŒ–å¸ƒå±€

#### 9.2 åŠŸèƒ½å®Œå–„
- [ ] æ·»åŠ ç³»ç»Ÿæ‰˜ç›˜
- [ ] æ·»åŠ æ¶ˆæ¯é€šçŸ¥
- [ ] æ·»åŠ å¤´åƒåŠŸèƒ½
- [ ] æ·»åŠ è¡¨æƒ…åŠŸèƒ½

#### 9.3 é”™è¯¯å¤„ç†
- [ ] ç½‘ç»œæ–­çº¿é‡è¿
- [ ] å¼‚å¸¸æƒ…å†µå¤„ç†
- [ ] ç”¨æˆ·æç¤ºä¼˜åŒ–

#### 9.4 æ€§èƒ½ä¼˜åŒ–
- [ ] æ¶ˆæ¯åˆ—è¡¨è™šæ‹ŸåŒ–
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] å†…å­˜ç®¡ç†ä¼˜åŒ–

### æµ‹è¯•ç›®æ ‡
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- âœ… æ€§èƒ½è‰¯å¥½
- âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½

---

## ğŸ“ å¼€å‘å»ºè®®

### 1. ä»£ç ç®¡ç†
- ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶
- æ¯ä¸ªé˜¶æ®µå®Œæˆåæäº¤ä¸€æ¬¡
- å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯

### 2. æµ‹è¯•ç­–ç•¥
- æ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½å°±æµ‹è¯•
- è®°å½•æµ‹è¯•ç»“æœ
- åŠæ—¶ä¿®å¤ bug

### 3. ä»£ç è§„èŒƒ
- éµå¾ª Qt ç¼–ç è§„èŒƒ
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- ä¿æŒä»£ç æ•´æ´

### 4. å­¦ä¹ è®°å½•
- è®°å½•é‡åˆ°çš„é—®é¢˜
- è®°å½•è§£å†³æ–¹æ¡ˆ
- æ€»ç»“å­¦ä¹ å¿ƒå¾—

---

## ğŸ“ å­¦ä¹ é‡ç‚¹

æ¯ä¸ªé˜¶æ®µçš„å­¦ä¹ é‡ç‚¹ï¼š

1. **é˜¶æ®µä¸€**ï¼šQt é¡¹ç›®ç»“æ„ã€åŸºç¡€ç±»è®¾è®¡
2. **é˜¶æ®µäºŒ**ï¼šTCP ç½‘ç»œç¼–ç¨‹ã€JSON åºåˆ—åŒ–
3. **é˜¶æ®µä¸‰**ï¼šæ•°æ®åº“æ“ä½œã€ç”¨æˆ·è®¤è¯
4. **é˜¶æ®µå››**ï¼šæ•°æ®åº“è®¾è®¡ã€SQL è¯­å¥
5. **é˜¶æ®µäº”**ï¼šUI ç»„ä»¶ã€ä¿¡å·æ§½æ·±å…¥åº”ç”¨
6. **é˜¶æ®µå…­**ï¼šçª—å£ç®¡ç†ã€æ¶ˆæ¯å¤„ç†
7. **é˜¶æ®µä¸ƒ**ï¼šç¾¤ç»„ç®¡ç†ã€æ¶ˆæ¯å¹¿æ’­
8. **é˜¶æ®µå…«**ï¼šæ–‡ä»¶ä¼ è¾“ã€è¿›åº¦æ˜¾ç¤º
9. **é˜¶æ®µä¹**ï¼šç³»ç»Ÿä¼˜åŒ–ã€ç”¨æˆ·ä½“éªŒ

---

## âœ… æœ€ç»ˆéªŒæ”¶

å®Œæˆæ‰€æœ‰é˜¶æ®µåï¼Œé¡¹ç›®åº”è¯¥å…·å¤‡ï¼š

- âœ… ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- âœ… å¥½å‹ç®¡ç†
- âœ… ä¸€å¯¹ä¸€èŠå¤©
- âœ… ç¾¤ç»„èŠå¤©
- âœ… æ–‡ä»¶ä¼ è¾“
- âœ… å†å²è®°å½•
- âœ… ç³»ç»Ÿæ‰˜ç›˜
- âœ… æ¶ˆæ¯é€šçŸ¥

**ç¥ä½ å¼€å‘é¡ºåˆ©ï¼é‡åˆ°é—®é¢˜éšæ—¶æŸ¥é˜…æ–‡æ¡£æˆ–æé—®ã€‚**

