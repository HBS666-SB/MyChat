# 即时聊天系统 (myChat)

## 项目概述

基于Qt框架开发的C/S架构即时聊天系统，支持多用户实时通信、好友管理、群组聊天、文件传输等功能。采用TCP/IP协议进行网络通信，使用SQLite数据库存储用户信息和聊天记录，实现了完整的即时通讯解决方案。

## 技术栈

- **开发语言**: C++11
- **开发框架**: Qt 5.x (Qt Widgets)
- **网络通信**: TCP/IP Socket编程
- **数据库**: SQLite
- **数据格式**: JSON
- **开发工具**: Qt Creator
- **架构模式**: C/S架构（客户端-服务器）

## 核心功能

### 1. 用户系统
- 用户注册与登录认证
- 密码验证与错误处理
- 用户状态管理（在线/离线）
- 头像设置与更新
- 重复登录检测

### 2. 好友管理
- 添加好友（搜索、申请、同意/拒绝）
- 删除好友
- 好友列表展示
- 好友在线状态实时更新
- 好友信息查看

### 3. 群组功能
- 创建群组
- 加入/退出群组
- 群组成员管理
- 群主权限管理
- 群组消息广播

### 4. 即时通讯
- **文本消息**: 支持实时文本聊天
- **表情消息**: 支持动画表情发送（100+表情包）
- **图片消息**: 支持图片发送与显示
- **文件传输**: 支持任意文件传输，带进度显示
- **消息历史**: 本地存储聊天记录，支持历史消息加载
- **消息队列**: 离线消息暂存与转发机制

### 5. 网络通信
- **消息服务器**: 基于TCP的消息传输服务（端口5363）
- **文件服务器**: 独立文件传输服务（端口7777），支持多线程并发
- **连接管理**: 自动重连、断线检测
- **数据协议**: 自定义JSON消息协议
- **消息类型**: 支持20+种消息类型（登录、注册、发送消息、文件传输等）

### 6. 用户界面
- **自定义窗口**: 无边框窗口，支持拖拽移动
- **聊天气泡**: 自定义聊天气泡UI，支持左右对齐
- **好友列表**: 分组展示（好友、群组、黑名单），支持展开/折叠
- **表情选择器**: 图形化表情选择界面
- **系统托盘**: 最小化到系统托盘，支持快速操作
- **右键菜单**: 丰富的上下文菜单操作

## 技术亮点

### 1. 网络架构设计
- **双服务器架构**: 消息服务器与文件服务器分离，提高系统性能
- **客户端Socket封装**: 封装QTcpSocket，实现消息解析、状态管理
- **服务器端连接池**: 使用QVector和QHash管理客户端连接，支持单播、组播、广播
- **消息队列机制**: 离线消息暂存，用户上线后自动转发

### 2. 文件传输优化
- **分片传输**: 文件分片发送（默认4KB），避免大文件阻塞
- **多线程处理**: 服务器端使用QThreadPool实现多线程文件接收
- **进度显示**: 实时显示文件传输进度
- **断点续传支持**: 文件传输状态管理

### 3. 数据库设计
- **单例模式**: 数据库管理类采用单例模式，确保线程安全
- **用户表**: 存储用户基本信息、密码、状态
- **好友关系表**: 管理好友关系
- **群组表**: 存储群组信息
- **消息表**: 存储私聊和群聊消息历史
- **消息队列表**: 存储离线消息

### 4. UI/UX设计
- **自定义控件**: 实现CustomMoveWidget、ChatBubble等自定义控件
- **动画效果**: 聊天气泡动画、列表展开动画
- **样式定制**: 使用QSS样式表美化界面
- **事件处理**: 键盘快捷键（Enter发送）、鼠标事件处理

### 5. 代码架构
- **模块化设计**: 按功能划分模块（netdb、basewidget、uipage、comapi）
- **信号槽机制**: 充分利用Qt信号槽实现组件间通信
- **MVC模式**: 列表控件采用MVC模式，数据与视图分离

## 项目结构

```
myChat/
├── Client/              # 客户端
│   ├── main.cpp        # 程序入口
│   ├── loginwidget.*   # 登录界面
│   ├── mainwindow.*    # 主窗口
│   ├── netdb/          # 网络通信模块
│   │   ├── mysocket.*  # TCP Socket封装
│   │   ├── filesocket.*# 文件传输Socket
│   │   └── databasemsg.*# 本地消息数据库
│   ├── basewidget/     # 基础控件
│   │   ├── chatbubble.*# 聊天气泡
│   │   └── qqlist/     # 好友列表控件
│   └── uipage/         # 页面UI
│       ├── chatwindow.*# 聊天窗口
│       └── face/       # 表情选择器
│
└── Server/             # 服务器端
    ├── main.cpp        # 程序入口
    ├── mainwindow.*    # 服务器管理界面
    └── netdb/          # 网络服务模块
        ├── myserver.*  # TCP服务器
        ├── clientsocket.*# 客户端连接管理
        ├── filesocket.*# 文件接收处理
        └── databasemag.*# 数据库管理
```

## 项目成果

1. **完整的即时通讯系统**: 实现了从用户注册、登录到消息传输的完整流程
2. **高性能网络通信**: 支持多客户端并发连接，消息实时传输
3. **良好的用户体验**: 美观的UI界面，流畅的交互体验
4. **可扩展架构**: 模块化设计，便于功能扩展和维护
5. **代码质量**: 规范的代码结构，合理的类设计，完善的错误处理

## 开发难点与解决方案

1. **TCP粘包问题**: 通过自定义消息头（长度+类型+数据）解决粘包问题
2. **多客户端管理**: 使用QHash快速查找在线用户，QVector管理连接列表
3. **文件传输稳定性**: 实现分片传输、错误重试机制
4. **离线消息处理**: 设计消息队列表，用户上线后批量转发
5. **UI性能优化**: 使用虚拟列表、分页加载历史消息，避免界面卡顿

## 适用场景

- 企业内部即时通讯
- 局域网聊天工具
- 学习Qt网络编程
- C++桌面应用开发实践

---

**项目时间**: 2025年
**开发环境**: Windows 10, Qt Creator
**项目规模**: 约5000+行代码

